-- Script generated by MySQL Compare 1.0.0.204 on 7/21/2011 12:47:35 PM

SET @ORIGINAL_FOREIGN_KEY_CHECKS=@@FOREIGN_KEY_CHECKS, FOREIGN_KEY_CHECKS=0;
SET @ORIGINAL_UNIQUE_CHECKS=@@UNIQUE_CHECKS, UNIQUE_CHECKS=0;
SET @ORIGINAL_SQL_MODE=@@SQL_MODE, SQL_MODE='TRADITIONAL';

USE `osae`;

DROP VIEW `osae`.`osae_v_object`;

CREATE VIEW `osae`.`osae_v_object` AS select `osae`.`osae_object`.`object_id` AS `object_id`,`osae`.`osae_object`.`object_name` AS `object_name`,`osae`.`osae_object`.`object_description` AS `object_description`,`osae`.`osae_object`.`object_value` AS `object_value`,`osae`.`osae_object`.`address` AS `address`,`osae`.`osae_object`.`last_updated` AS `last_updated`,`osae`.`osae_object`.`last_state_change` AS `last_state_change`,`osae`.`osae_object`.`enabled` AS `enabled`,`osae`.`osae_object_type`.`object_type_id` AS `object_type_id`,`osae`.`osae_object_type`.`object_type` AS `object_type`,`osae`.`osae_object_type`.`object_type_description` AS `object_type_description`,`osae`.`osae_object_type`.`plugin_object_id` AS `plugin_object_id`,`osae`.`osae_object_type`.`system_hidden` AS `system_hidden`,`osae`.`osae_object_type`.`object_type_owner` AS `object_type_owner`,`osae`.`osae_object_type`.`base_type_id` AS `base_type_id`,`osae`.`osae_object_type`.`container` AS `container`,`osae`.`osae_object_type_state`.`state_id` AS `state_id`,`osae`.`osae_object_type_state`.`state_name` AS `state_name`,`osae`.`osae_object_type_state`.`state_label` AS `state_label`,`objects_2`.`object_name` AS `owned_by`,`object_types_2`.`object_type` AS `base_type`,`objects_1`.`object_name` AS `container_name`,`osae`.`osae_object`.`container_id` AS `container_id`,timestampdiff(MINUTE,`osae`.`osae_object`.`last_state_change`,now()) AS `time_in_state` from (((((`osae`.`osae_object` left join `osae`.`osae_object_type` on((`osae`.`osae_object`.`object_type_id` = `osae`.`osae_object_type`.`object_type_id`))) left join `osae`.`osae_object_type` `object_types_2` on((`osae`.`osae_object_type`.`base_type_id` = `object_types_2`.`object_type_id`))) left join `osae`.`osae_object` `objects_2` on((`osae`.`osae_object_type`.`plugin_object_id` = `objects_2`.`object_id`))) left join `osae`.`osae_object_type_state` on(((`osae`.`osae_object_type`.`object_type_id` = `osae`.`osae_object_type_state`.`object_type_id`) and (`osae`.`osae_object_type_state`.`state_id` = `osae`.`osae_object`.`state_id`)))) left join `osae`.`osae_object` `objects_1` on((`objects_1`.`object_id` = `osae`.`osae_object`.`container_id`)));

DROP VIEW `osae`.`osae_v_screen_object`;

CREATE VIEW `osae`.`osae_v_screen_object` AS select `so`.`screen_object_id` AS `screen_object_id`,`so`.`screen_id` AS `screen_id`,`so`.`object_id` AS `object_id`,`so`.`control_id` AS `control_id`,`screen`.`object_name` AS `screen_name`,`control`.`object_name` AS `control_name`,`o`.`object_name` AS `object_name`,`controltype`.`object_type` AS `control_type`,`controlbasetype`.`object_type` AS `control_base_type`,`o`.`last_updated` AS `last_updated`,`o`.`last_state_change` AS `last_state_change`,timestampdiff(MINUTE,`o`.`last_state_change`,now()) AS `time_in_state` from (((((`osae`.`osae_screen_object` `so` join `osae`.`osae_object` `screen` on((`screen`.`object_id` = `so`.`screen_id`))) join `osae`.`osae_object` `control` on((`control`.`object_id` = `so`.`control_id`))) join `osae`.`osae_object_type` `controltype` on((`controltype`.`object_type_id` = `control`.`object_type_id`))) join `osae`.`osae_object_type` `controlbasetype` on((`controlbasetype`.`object_type_id` = `controltype`.`base_type_id`))) join `osae`.`osae_object` `o` on((`o`.`object_id` = `so`.`object_id`)));

DROP VIEW `osae`.`osae_v_screen_updates`;

CREATE VIEW `osae`.`osae_v_screen_updates` AS select `osae_v_screen_object`.`screen_object_id` AS `screen_object_id`,`osae_v_screen_object`.`screen_id` AS `screen_id`,`osae_v_screen_object`.`object_id` AS `object_id`,`osae_v_screen_object`.`control_id` AS `control_id`,`osae_v_screen_object`.`screen_name` AS `screen_name`,`osae_v_screen_object`.`control_name` AS `control_name`,`osae_v_screen_object`.`object_name` AS `object_name`,`osae_v_screen_object`.`last_updated` AS `last_updated`,`osae_v_screen_object`.`last_state_change` AS `last_state_change`,`osae`.`osae_object_type_state`.`state_name` AS `state_name`,`osae`.`osae_object_type_state`.`state_label` AS `state_label`,`osae`.`osae_object_type_property`.`property_name` AS `property_name`,`osae`.`osae_object_property`.`property_value` AS `property_value` from ((((`osae`.`osae_object` left join `osae`.`osae_object_type_state` on((`osae`.`osae_object`.`state_id` = `osae`.`osae_object_type_state`.`state_id`))) join `osae`.`osae_v_screen_object` on((`osae`.`osae_object`.`object_id` = `osae_v_screen_object`.`object_id`))) left join `osae`.`osae_object_type_property` on((`osae`.`osae_object_type_property`.`object_type_id` = `osae`.`osae_object`.`object_type_id`))) left join `osae`.`osae_object_property` on((`osae`.`osae_object_type_property`.`property_id` = `osae`.`osae_object_property`.`object_type_property_id`))) where (`osae_v_screen_object`.`last_updated` > subtime(now(),'00:00:30'));

DROP PROCEDURE `osae`.`osae_sp_debug_log_add`;

DELIMITER |
CREATE PROCEDURE `osae_sp_debug_log_add`(
  IN  pentry       varchar(200),
  IN  pdebugtrace  varchar(200)
)
BEGIN
  IF ISNULL(pentry) = FALSE Then
    INSERT INTO osae_debug_log(entry,debug_trace) VALUES(pentry,pdebugtrace);
  END IF;
END|
DELIMITER ;

DROP PROCEDURE `osae`.`osae_sp_event_log_add`;

DELIMITER |
CREATE PROCEDURE `osae_sp_event_log_add`(
  IN  pobject      varchar(200),
  IN  pevent       varchar(200),
  IN  pfromobject  varchar(200),
  IN  pdebuginfo   varchar(1000)
)
BEGIN
DECLARE vObjectCount INT;
DECLARE vObjectID INT;
DECLARE vObjectTypeID INT;
DECLARE vEventCount INT;
DECLARE vEventID INT;
DECLARE vFromObjectID INT DEFAULT NULL;
DECLARE vFromObjectCount INT;
DECLARE vDebugTrace VARCHAR(2000);
    SET vDebugTrace = CONCAT(COALESCE(pdebuginfo,''),' -> osae_sp_event_log_add');
    SET vFromObjectID = (SELECT object_id FROM osae_object WHERE UPPER(object_name)=UPPER(pfromobject));
    SELECT COUNT(object_id) INTO vObjectCount FROM osae_object WHERE UPPER(object_name)=UPPER(pobject);
    IF vObjectCount > 0 THEN
        SELECT object_id,object_type_id INTO vObjectID,vObjectTypeID FROM osae_object WHERE UPPER(object_name)=UPPER(pobject);
        SELECT COUNT(event_id) INTO vEventCount FROM osae_object_type_event WHERE object_type_id=vObjectTypeID AND UPPER(event_name)=UPPER(pevent);
        IF vEventCount = 1 THEN  
            CALL osae_sp_debug_log_add(CONCAT('Event_Log_add (',pobject,' ',pevent,') ',pfromobject,' vFromObjectID ',COALESCE(vFromObjectID,'NULL')),vDebugTrace);
            SELECT event_id INTO vEventID FROM osae_object_type_event WHERE object_type_id=vObjectTypeID AND UPPER(event_name)=UPPER(pevent);
            INSERT INTO osae_event_log (object_id,event_id,from_object_id,debug_trace) VALUES(vObjectID,vEventID,vFromObjectID,vDebugTrace);
        END IF;
    END IF; 
END|
DELIMITER ;

DROP PROCEDURE `osae`.`osae_sp_object_state_set`;

DELIMITER |
CREATE PROCEDURE `osae_sp_object_state_set`(
  IN  pname        varchar(200),
  IN  pstate       varchar(50),
  IN  pfromobject  varchar(200),
  IN  pdebuginfo   varchar(2000)
)
BEGIN
DECLARE vObjectCount INT;
DECLARE vObjectID INT;
DECLARE vObjectTypeID INT;
DECLARE vStateCount INT;
DECLARE vOldStateID INT;
DECLARE vStateID INT;
DECLARE vEventCount INT;
DECLARE vHideRedundantEvents INT;
DECLARE vDebugTrace VARCHAR(2000) DEFAULT '';
    SET vDebugTrace = CONCAT(pdebuginfo,' -> osae_sp_object_state_set');
    SELECT COUNT(object_id) INTO vObjectCount FROM osae_object WHERE UPPER(object_name)=UPPER(pname);
    IF vObjectCount = 1 THEN
        SELECT object_id,object_type_id,state_id INTO vObjectID,vObjectTypeID,vOldStateID FROM osae_object WHERE UPPER(object_name)=UPPER(pname) LIMIT 1;
        SELECT COUNT(state_id) INTO vStateCount FROM osae_object_type_state WHERE object_type_id=vObjectTypeID AND (UPPER(state_name)=UPPER(pstate) OR UPPER(state_label)=UPPER(pstate));
        IF vStateCount = 1 THEN       
            SELECT state_id INTO vStateID FROM osae_object_type_state WHERE object_type_id=vObjectTypeID AND (UPPER(state_name)=UPPER(pstate) OR UPPER(state_label)=UPPER(pstate)) LIMIT 1;
            UPDATE osae_object SET state_id=vStateID,last_updated=NOW() WHERE object_id=vObjectID;
            SELECT COUNT(event_id) INTO vEventCount FROM osae_v_object_type_event WHERE object_type_id=vObjectTypeID AND UPPER(event_name)=UPPER(pstate) LIMIT 1;
            IF vEventCount = 1 THEN
                SELECT hide_redundant_events INTO vHideRedundantEvents FROM osae_v_object_type_event WHERE object_type_id=vObjectTypeID AND UPPER(event_name)=UPPER(pstate) LIMIT 1;
                IF vOldStateID <> vStateID OR vHideRedundantEvents = 0 Then
                    CALL osae_sp_event_log_add(pname,pstate,pfromobject,vDebugTrace);
                END IF;
            END IF;  
        END IF;
    END IF; 
END|
DELIMITER ;

DROP PROCEDURE `osae`.`osae_sp_object_property_set`;

DELIMITER |
CREATE PROCEDURE `osae_sp_object_property_set`(
  IN  pname        varchar(200),
  IN  pproperty    varchar(200),
  IN  pvalue       varchar(255),
  IN  pfromobject  varchar(200),
  IN  pdebuginfo   varchar(2000)
)
BEGIN
DECLARE vObjectID INT DEFAULT 0;
DECLARE vObjectCount INT DEFAULT 0;
DECLARE vObjectTypeID INT DEFAULT 0;
DECLARE vPropertyID INT DEFAULT 0;
DECLARE vPropertyValue VARCHAR(2000);
DECLARE vPropertyCount INT DEFAULT 0;
DECLARE vEventCount INT;
DECLARE vDebugTrace VARCHAR(2000) DEFAULT '';
    SET vDebugTrace = CONCAT(pdebuginfo,' -> osae_sp_object_property_set');
    SELECT COUNT(object_id) INTO vObjectCount FROM osae_object WHERE UPPER(object_name)=UPPER(pname); 
    IF vObjectCount > 0 THEN  
        SELECT object_id,object_type_id INTO vObjectID,vObjectTypeID FROM osae_object WHERE UPPER(object_name)=UPPER(pname);
        SELECT COUNT(property_id) INTO vPropertyCount FROM osae_v_object_property WHERE UPPER(object_name)=UPPER(pname) AND UPPER(property_name)=UPPER(pproperty) AND (property_value IS NULL OR property_value != pvalue);        
        IF vPropertyCount > 0 THEN
            SELECT property_id,COALESCE(property_value,'') INTO vPropertyID, vPropertyValue FROM osae_v_object_property WHERE UPPER(object_name)=UPPER(pname) AND UPPER(property_name)=UPPER(pproperty) AND (property_value IS NULL OR property_value != pvalue);
            UPDATE osae_object_property SET property_value=pvalue WHERE object_id=vObjectID AND object_type_property_id=vPropertyID;
            UPDATE osae_object SET last_updated=NOW() WHERE object_id=vObjectID;            
            SELECT COUNT(event_id) INTO vEventCount FROM osae_object_type_event WHERE object_type_id=vObjectTypeID AND UPPER(event_name)=UPPER(pproperty);
            IF vEventCount > 0 THEN  
                CALL osae_sp_event_log_add(pname,pproperty,pfromobject,vDebugTrace);
            END IF;
        END IF;
    END IF; 
END|
DELIMITER ;

DROP PROCEDURE `osae`.`osae_sp_method_queue_add`;

DELIMITER |
CREATE PROCEDURE `osae_sp_method_queue_add`(
  IN  pobject      varchar(200),
  IN  pmethod      varchar(200),
  IN  pparameter1  varchar(1024),
  IN  pparameter2  varchar(1024),
  IN  pfromobject  varchar(200),
  IN  pdebuginfo   varchar(1000)
)
BEGIN
DECLARE vObjectCount INT;
DECLARE vObjectID INT;
DECLARE vObjectTypeID INT;
DECLARE vMethodCount INT;
DECLARE vMethodID INT;
DECLARE vSystemCount INT;
DECLARE vObjectName VARCHAR(200);
DECLARE vObjectType VARCHAR(200);
DECLARE vBaseType VARCHAR(200);
DECLARE vFromObjectID INT DEFAULT NULL;
DECLARE vFromObjectCount INT;
DECLARE vStateCount INT;
DECLARE vDebugTrace VARCHAR(1000);
DECLARE vPropertyCount INT;
DECLARE vMethod VARCHAR(200);
SET max_sp_recursion_depth = 10;
SET vDebugTrace = CONCAT(pdebuginfo,' -> osae_sp_method_queue_add');
    SET vFromObjectID = (SELECT object_id INTO vFromObjectID FROM osae_object WHERE UPPER(object_name)=UPPER(pfromobject));
    SELECT COUNT(object_id) INTO vObjectCount FROM osae_object WHERE UPPER(object_name)=UPPER(pobject);
    IF vObjectCount = 1 THEN
        SELECT object_id,object_type_id INTO vObjectID,vObjectTypeID FROM osae_object WHERE UPPER(object_name)=UPPER(pobject);
        SELECT COUNT(method_id) INTO vMethodCount FROM osae_object_type_method WHERE object_type_id=vObjectTypeID AND (UPPER(method_name)=UPPER(pmethod) OR UPPER(method_label)=UPPER(pmethod));
        IF vMethodCount > 0 THEN       
            SELECT method_id INTO vMethodID FROM osae_object_type_method WHERE object_type_id=vObjectTypeID AND (UPPER(method_name)=UPPER(pmethod) OR UPPER(method_label)=UPPER(pmethod));
            # Check to see if an app owns this, or SYSTEM, if system owns we will have to handle events....
            SELECT count(object_id) INTO vSystemCount FROM osae_v_object WHERE object_id=vObjectID AND owned_by='SYSTEM';
            IF vSystemCount = 1 THEN
                SELECT object_name,object_type,base_type INTO vObjectName,vObjectType,vBaseType FROM osae_v_object WHERE object_id=vObjectID;
                SELECT method_name INTO vMethod FROM osae_object_type_method WHERE method_id=vMethodID;        
                # Here is the magic, if the Method Name matches a State, then the Method's Job is to Set that State, so look up the state
                SELECT count(state_name) INTO vStateCount FROM osae_v_object_type_state WHERE UPPER(state_name)=UPPER(vMethod) AND object_type=vObjectType; 
                IF vStateCount = 1 THEN   
                    CALL osae_sp_object_state_set (vObjectName,vMethod,pfromobject,vDebugTrace);
                ELSE
                  SELECT count(property_name) INTO vPropertyCount FROM osae_v_object_type_property WHERE UPPER(property_name)=UPPER(vMethod) AND object_type=vObjectType; 
                  IF vPropertyCount = 1 THEN   
                      CALL osae_sp_object_property_set (vObjectName,vMethod,pparameter1,pfromobject,vDebugTrace);
                  END IF;
                END IF;                
            ELSE
                INSERT INTO osae_method_queue (object_id,method_id,parameter_1,parameter_2,from_object_id,debug_trace) VALUES(vObjectID,vMethodID,pparameter1,pparameter2,vFromObjectID,vDebugTrace);
            END IF;       
        END IF;
    END IF; 
END|
DELIMITER ;

DELIMITER |
CREATE PROCEDURE `osae_sp_object_property_array_get_all`(IN pobject VARCHAR(255), IN pproperty VARCHAR(255))
BEGIN
  SELECT item_name FROM osae_v_object_property_array WHERE object_name=pobject AND property_name=pproperty;
END|
DELIMITER ;

DELIMITER |
CREATE PROCEDURE `osae_sp_pattern_delete`(
  IN pname varchar(100)
)
BEGIN
  DELETE FROM osae_pattern WHERE pattern=pname;
END|
DELIMITER ;

DROP PROCEDURE `osae`.`osae_sp_process_recurring`;

DELIMITER |
CREATE PROCEDURE `osae_sp_process_recurring`()
BEGIN
DECLARE iRECURRINGID INT;
DECLARE vOBJECTNAME VARCHAR(400) DEFAULT '';
DECLARE vMETHODNAME VARCHAR(400) DEFAULT '';
DECLARE vPARAM1 VARCHAR(200);
DECLARE vPARAM2 VARCHAR(200);
DECLARE iPATTERNID INT;
DECLARE cINTERVAL CHAR(1);
DECLARE cSUNDAY CHAR(1);
DECLARE cMONDAY CHAR(1);
DECLARE cTUESDAY CHAR(1);
DECLARE cWEDNESDAY CHAR(1);
DECLARE cTHURSDAY CHAR(1);
DECLARE cFRIDAY CHAR(1);
DECLARE cSATURDAY CHAR(1);
DECLARE dRECURRINGDATE DATE;
DECLARE iRECURRINGMINUTES INT;
DECLARE dRECURRINGDAY INT;
DECLARE dRECURRINGTIME TIME;
DECLARE dCURDATE DATE;
DECLARE dCURDATETIME DATETIME;
DECLARE dCURDAYOFWEEK INT DEFAULT 0;
DECLARE dCURDAYOFMONTH INT DEFAULT 1;
DECLARE dCURDAY INT DEFAULT 1;
DECLARE iMATCHES INT DEFAULT 0;
DECLARE iDATEDIFF INT DEFAULT 0;
DECLARE done INT DEFAULT 0;  
DECLARE cur1 CURSOR FOR SELECT recurring_id,interval_unit,recurring_time,recurring_minutes,recurring_date,recurring_day,object_name,method_name,parameter_1,parameter_2,pattern_id,sunday,monday,tuesday,wednesday,thursday,friday,saturday FROM osae_v_schedule_recurring;
DECLARE CONTINUE HANDLER FOR SQLSTATE '02000' SET done = 1;
    OPEN cur1; 
    Loop_Tag: LOOP
        IF done THEN
            Leave Loop_Tag;
        END IF;
        FETCH cur1 INTO iRECURRINGID,cINTERVAL,dRECURRINGTIME,iRECURRINGMINUTES,dRECURRINGDATE,dRECURRINGDAY,vOBJECTNAME,vMETHODNAME,vPARAM1,vPARAM2,iPATTERNID,cSUNDAY,cMONDAY,cTUESDAY,cWEDNESDAY,cTHURSDAY,cFRIDAY,cSATURDAY;
        CALL osae_sp_debug_log_add(CONCAT('ID=',iRECURRINGID,', Interval=',cINTERVAL,' Time=',dRECURRINGTIME,' Date=',dRECURRINGDATE),'sp_process_recurring'); 
        IF NOT done THEN
            IF cINTERVAL = 'Y' THEN
                SET dCURDATE = CURDATE();
                CALL osae_sp_debug_log_add(CONCAT('--IF ',dRECURRINGDATE,' < ',dCURDATE,' THEN'),'SYSTEM'); 
                IF dRECURRINGDATE < dCURDATE THEN
                    SET iDATEDIFF = DATEDIFF(dCURDATE,dRECURRINGDATE) / 365; 
                    CALL osae_sp_debug_log_add(CONCAT('sp_process_recurring: DateDiff=',iDATEDIFF),'SYSTEM'); 
                    SET dRECURRINGDATE = DATE_ADD(dRECURRINGDATE,INTERVAL iDATEDIFF YEAR);
                    IF dRECURRINGDATE < dCURDATE THEN 
                        SET dRECURRINGDATE = DATE_ADD(dRECURRINGDATE,INTERVAL 1 YEAR);                   
                    END IF;                                     
                END IF;
                CALL osae_sp_debug_log_add(CONCAT(dRECURRINGDATE,' ',TIME(dRECURRINGTIME)),'SYSTEM'); 
                SELECT COUNT(schedule_ID) INTO iMATCHES FROM osae_schedule_queue WHERE recurring_id=iRECURRINGID;      
                IF iMATCHES = 0 THEN
                    CALL osae_sp_schedule_queue_add (CONCAT(dRECURRINGDATE,' ',TIME(dRECURRINGTIME)),vOBJECTNAME,vMETHODNAME,vPARAM1,vPARAM2,iPATTERNID,iRECURRINGID);
                END IF;
              ELSEIF cINTERVAL = 'T' THEN   
                SET dCURDATETIME = NOW();             
                SET dCURDATE = CURDATE();
                IF dCURDATETIME > CONCAT(dCURDATE,' ',ADDTIME(NOW(),SEC_TO_TIME(iRECURRINGMINUTES * 60))) THEN
                    SET dCURDAYOFWEEK = dCURDAYOFWEEK + 1;
                    SET dCURDATE=DATE_ADD(CURDATE(),INTERVAL 1 DAY);
                END IF; 
                CALL osae_sp_debug_log_add(CONCAT(dRECURRINGDATE,' ',TIME(dRECURRINGTIME)),'SYSTEM'); 
                SELECT COUNT(schedule_ID) INTO iMATCHES FROM osae_schedule_queue WHERE recurring_id=iRECURRINGID;      
                IF iMATCHES = 0 THEN
                    CALL osae_sp_schedule_queue_add (CONCAT(dCURDATE,' ',ADDTIME(NOW(),SEC_TO_TIME(iRECURRINGMINUTES * 60))),vOBJECTNAME,vMETHODNAME,vPARAM1,vPARAM2,iPATTERNID,iRECURRINGID);
                END IF;               
            ELSEIF cINTERVAL = 'M' THEN                
                SET dCURDATE = CURDATE();
                SET dRECURRINGDATE = CONCAT(YEAR(NOW()),'-',MONTH(NOW()),'-' ,dRECURRINGDAY);                
                IF dRECURRINGDATE < dCURDATE THEN
                    CALL osae_sp_debug_log_add(CONCAT('sp_process_recurring: DateDiff=',iDATEDIFF),'SYSTEM');                
                    SET dRECURRINGDATE = DATE_ADD(dRECURRINGDATE,INTERVAL 1 MONTH);
                    IF dRECURRINGDATE < dCURDATE THEN 
                        SET dRECURRINGDATE = DATE_ADD(dRECURRINGDATE,INTERVAL 1 MONTH);                   
                    END IF;                                     
                END IF;
                CALL osae_sp_debug_log_add(CONCAT(dRECURRINGDATE,' ',TIME(dRECURRINGTIME)),'SYSTEM'); 
                SELECT COUNT(schedule_ID) INTO iMATCHES FROM osae_schedule_queue WHERE recurring_id=iRECURRINGID;      
                IF iMATCHES = 0 THEN
                    CALL osae_sp_schedule_queue_add (CONCAT(dRECURRINGDATE,' ',TIME(dRECURRINGTIME)),vOBJECTNAME,vMETHODNAME,vPARAM1,vPARAM2,iPATTERNID,iRECURRINGID);
                END IF;               
            ELSEIF cINTERVAL = 'D' THEN                
                SET dCURDATETIME = NOW();
                SET dCURDATE = CURDATE();
                SET dCURDAYOFWEEK = DAYOFWEEK(NOW()); 
                SET dCURDAYOFMONTH = DAYOFMONTH(NOW());
  
                IF dCURDATETIME > CONCAT(dCURDATE,' ',dRECURRINGTIME) THEN
                    SET dCURDAYOFWEEK = dCURDAYOFWEEK + 1;
                    SET dCURDATE=DATE_ADD(CURDATE(),INTERVAL 1 DAY);
                END IF; 
                CALL osae_sp_debug_log_add(CONCAT('IF ',dCURDATETIME,' > ',dCURDATE,' ',dRECURRINGTIME,' Then Write new queue'),'SYSTEM');              
                IF dCURDAYOFWEEK = 1 AND cSUNDAY = 1 THEN
                    SELECT COUNT(schedule_ID) INTO iMATCHES FROM osae_schedule_queue WHERE recurring_id=iRECURRINGID;      
                    IF iMATCHES = 0 THEN
                        CALL osae_sp_schedule_queue_add (CONCAT(dCURDATE,' ',TIME(dRECURRINGTIME)),vOBJECTNAME,vMETHODNAME,vPARAM1,vPARAM2,iPATTERNID,iRECURRINGID);
                    END IF; 
                END IF; 
                IF dCURDAYOFWEEK = 2 AND cMONDAY = 1 THEN                
                    SELECT COUNT(schedule_ID) INTO iMATCHES FROM osae_schedule_queue WHERE recurring_id=iRECURRINGID;      
                    IF iMATCHES = 0 THEN
                        CALL osae_sp_schedule_queue_add (CONCAT(dCURDATE,' ',TIME(dRECURRINGTIME)),vOBJECTNAME,vMETHODNAME,vPARAM1,vPARAM2,iPATTERNID,iRECURRINGID);          
                    END IF; 
                END IF; 
                IF dCURDAYOFWEEK = 3 AND cTUESDAY = 1 THEN                
                    SELECT COUNT(schedule_ID) INTO iMATCHES FROM osae_schedule_queue WHERE recurring_id=iRECURRINGID;      
                    IF iMATCHES = 0 THEN
                        CALL osae_sp_schedule_queue_add (CONCAT(dCURDATE,' ',TIME(dRECURRINGTIME)),vOBJECTNAME,vMETHODNAME,vPARAM1,vPARAM2,iPATTERNID,iRECURRINGID);
                    END IF; 
                END IF;                 
                IF dCURDAYOFWEEK = 4 AND cWEDNESDAY = 1 THEN                
                    SELECT COUNT(schedule_ID) INTO iMATCHES FROM osae_schedule_queue WHERE recurring_id=iRECURRINGID;      
                    IF iMATCHES = 0 THEN
                        CALL osae_sp_schedule_queue_add (CONCAT(dCURDATE,' ',TIME(dRECURRINGTIME)),vOBJECTNAME,vMETHODNAME,vPARAM1,vPARAM2,iPATTERNID,iRECURRINGID);   
                    END IF; 
                END IF;  
                IF dCURDAYOFWEEK = 5 AND cTHURSDAY = 1 THEN                
                    SELECT COUNT(schedule_ID) INTO iMATCHES FROM osae_schedule_queue WHERE recurring_id=iRECURRINGID;      
                    IF iMATCHES = 0 THEN
                        CALL osae_sp_schedule_queue_add (CONCAT(dCURDATE,' ',TIME(dRECURRINGTIME)),vOBJECTNAME,vMETHODNAME,vPARAM1,vPARAM2,iPATTERNID,iRECURRINGID);                    
                    END IF; 
                END IF;
                IF dCURDAYOFWEEK = 6 AND cFRIDAY = 1 THEN                
                    SELECT COUNT(schedule_ID) INTO iMATCHES FROM osae_schedule_queue WHERE recurring_id=iRECURRINGID;      
                    IF iMATCHES = 0 THEN
                        CALL osae_sp_schedule_queue_add (CONCAT(dCURDATE,' ',TIME(dRECURRINGTIME)),vOBJECTNAME,vMETHODNAME,vPARAM1,vPARAM2,iPATTERNID,iRECURRINGID);                    
                    END IF; 
                END IF;
                IF dCURDAYOFWEEK = 7 AND cSATURDAY = 1 THEN                
                    SELECT COUNT(schedule_ID) INTO iMATCHES FROM osae_schedule_queue WHERE recurring_id=iRECURRINGID;      
                    IF iMATCHES = 0 THEN
                        CALL osae_sp_schedule_queue_add (CONCAT(dCURDATE,' ',TIME(dRECURRINGTIME)),vOBJECTNAME,vMETHODNAME,vPARAM1,vPARAM2,iPATTERNID,iRECURRINGID);                    
                   END IF; 
                END IF;                                                                           
            END IF;         
        END IF;
     END LOOP;
    CLOSE cur1;   
END|
DELIMITER ;

DROP PROCEDURE `osae`.`osae_sp_run_scheduled_methods`;

DELIMITER |
CREATE PROCEDURE `osae_sp_run_scheduled_methods`()
BEGIN
DECLARE iSCHEDULEID INT;
DECLARE iOBJECTID INT DEFAULT 0;
DECLARE vObjectName VARCHAR(400) DEFAULT '';
DECLARE iMETHODID INT DEFAULT 0;
DECLARE vMethodName VARCHAR(400);
DECLARE vPARAM1 VARCHAR(200);
DECLARE vPARAM2 VARCHAR(200);
DECLARE iPATTERNID INT DEFAULT 0;
DECLARE done INT DEFAULT 0;  
DECLARE cur1 CURSOR FOR SELECT schedule_ID,object_name,method_name,parameter_1,parameter_2,pattern_id FROM osae_v_schedule_queue WHERE queue_datetime < NOW();
DECLARE CONTINUE HANDLER FOR SQLSTATE '02000' SET done = 1;
    OPEN cur1; 
    Loop_Tag: LOOP
        IF done THEN
            Leave Loop_Tag;
        END IF;
        FETCH cur1 INTO iSCHEDULEID,vObjectName,vMethodName,vPARAM1,vPARAM2,iPATTERNID;
            CALL osae_sp_debug_log_add(CONCAT('Found Scheduled Method to run:',iSCHEDULEID),'osae_sp_run_scheduled_methods');
            DELETE FROM osae_schedule_queue WHERE schedule_ID=iSCHEDULEID; 
            IF vObjectName != '' THEN
                CALL osae_sp_method_queue_add(vObjectName,vMethodName,vPARAM1,vPARAM2,'SYSTEM','osae_sp_run_scheduled_methods');
            ELSEIF iPATTERNID != 0 THEN
                CALL osae_sp_method_queue_add('SCRIPT PROCESSOR','PATTERN SCRIPT',iPATTERNID,'SYSTEM','SYSTEM','osae_sp_run_scheduled_methods');
            END IF;         
        END LOOP;
    CLOSE cur1;
    CALL osae_sp_process_recurring();   
END|
DELIMITER ;

DROP PROCEDURE `osae`.`osae_sp_system_count_occupants`;

DELIMITER |
CREATE PROCEDURE `osae_sp_system_count_occupants`()
BEGIN
DECLARE vOccupantCount INT;
DECLARE vOldCount INT;
DECLARE vTemp VARCHAR(200);
DECLARE vOutput VARCHAR(200);
    SET vOldCount = (SELECT property_value FROM osae_v_object_property WHERE object_name='SYSTEM' AND property_name='Occupants');
    SELECT COUNT(object_id) INTO vOccupantCount FROM osae_v_object WHERE object_type='PERSON' AND state_name='ON';
    IF vOldCount != vOccupantCount THEN
        CALL osae_sp_object_property_set('SYSTEM','Occupants',vOccupantCount,'SYSTEM','osae_sp_system_count_occupants');
        CASE vOccupantCount
          WHEN 0 THEN 
            SET vOutput = 'Nobody is here';
            CALL osae_sp_object_property_set('SYSTEM','Occupant String',vOutput,'SYSTEM','osae_sp_system_count_occupants');            
          WHEN 1 THEN 
            SET vOutput = (SELECT COALESCE(object_name,'Nobody') FROM osae_v_object WHERE object_type='PERSON' AND state_name='ON' LIMIT 1);
            SET vOutput = CONCAT(vOutput,' is here');
            CALL osae_sp_object_property_set('SYSTEM','Occupant String',vOutput,'SYSTEM','osae_sp_system_count_occupants');
          WHEN 2 THEN
            SET vTemp = (SELECT object_name FROM osae_v_object WHERE object_type='PERSON' AND state_name='ON' LIMIT 1);
            SET vOutput = (SELECT object_name FROM osae_v_object WHERE object_type='PERSON' AND state_name='ON' AND object_name<>vTemp LIMIT 1);    
            SET vOutput = CONCAT(vOutput,' and ',vTemp,' are here');
            CALL osae_sp_object_property_set('SYSTEM','Occupant String',vOutput,'SYSTEM','osae_sp_system_count_occupants');
         END CASE;
    END IF;
    SET vOldCount = 0;
    SET vOldCount = (SELECT COALESCE(property_value,0) FROM osae_v_object_property WHERE object_name='SYSTEM' AND property_name='Occupied Locations');
    SELECT COUNT(object_id) INTO vOccupantCount FROM osae_v_object WHERE object_type='PLACE' AND state_name='ON';
    #CALL osae_sp_debug_log_add(CONCAT('Counted Places: ',vOccupantCount, ' Old count = ',vOldCount),'SYSTEM');
    IF vOldCount != vOccupantCount THEN
        CALL osae_sp_object_property_set('SYSTEM','Occupied Locations',vOccupantCount,'SYSTEM','osae_sp_system_count_occupants');
        CASE vOccupantCount
          WHEN 0 THEN 
            SET vOutput = 'All Locations are Vacant';
            CALL osae_sp_object_property_set('SYSTEM','Occupied Location String',vOutput,'SYSTEM','osae_sp_system_count_occupants');            
          WHEN 1 THEN 
            SET vOutput = (SELECT object_name FROM osae_v_object WHERE object_type='PLACE' AND state_name='ON' LIMIT 1);
            SET vOutput = CONCAT('The ',vOutput,' is occupied');
            CALL osae_sp_object_property_set('SYSTEM','Occupied Location String',vOutput,'SYSTEM','osae_sp_system_count_occupants');
          WHEN 2 THEN
            SET vTemp = (SELECT object_name FROM osae_v_object WHERE object_type='PLACE' AND state_name='ON' LIMIT 1);
            SET vOutput = (SELECT object_name FROM osae_v_object WHERE object_type='PLACE' AND state_name='ON' AND object_name<>vTemp LIMIT 1);    
            SET vOutput = CONCAT('The ',vOutput,' and the ',vTemp,' are occupied');
            CALL osae_sp_object_property_set('SYSTEM','Occupied Location String',vOutput,'SYSTEM','osae_sp_system_count_occupants');
         END CASE;
    END IF;    
END|
DELIMITER ;

DROP TRIGGER `osae`.`osae_tr_object_after_insert`;

DELIMITER |
CREATE TRIGGER osae_tr_object_after_insert
	AFTER INSERT
	ON osae_object
	FOR EACH ROW
BEGIN
DECLARE vPropertyID INT;
DECLARE vDefault VARCHAR(255);
DECLARE done INT DEFAULT 0;  
DECLARE cur1 CURSOR FOR SELECT property_id,property_default FROM osae_object_type_property WHERE object_type_id=NEW.`object_type_id`;
DECLARE CONTINUE HANDLER FOR NOT FOUND SET done = 1;
    OPEN cur1; 
    REPEAT
        FETCH cur1 INTO vPropertyID,vDefault;
        IF NOT done THEN 
            INSERT INTO osae_object_property (object_id,object_type_property_id,property_value) VALUES(NEW.`object_id`,vPropertyID,vDefault);
        END IF;
    UNTIL done END REPEAT;
    CLOSE cur1;
    INSERT INTO osae_object_state_history (object_id,state_id) SELECT NEW.`object_id`, state_id FROM osae_v_object_state WHERE object_id=NEW.object_id;        
END|
DELIMITER ;

DROP EVENT `osae`.`osae_ev_minute_maint`;

DELIMITER |
CREATE EVENT `osae_ev_minute_maint` ON SCHEDULE EVERY 1 MINUTE STARTS '2010-06-08 21:39:17' ON COMPLETION NOT PRESERVE ENABLE DO BEGIN
    CALL osae_sp_object_property_set('SYSTEM','Date',CURDATE(),'SYSTEM','osae_ev_minute_maint'); 
    CALL osae_sp_object_property_set('SYSTEM','Day Of Week',DAYOFWEEK(CURDATE()),'SYSTEM','osae_ev_minute_maint'); 
    CALL osae_sp_object_property_set('SYSTEM','Day Of Month',DAYOFMONTH(CURDATE()),'SYSTEM','osae_ev_minute_maint'); 
    CALL osae_sp_run_scheduled_methods; 
    CALL osae_sp_debug_log_add('Minute timer','SYSTEM');  
END|
DELIMITER ;

DROP EVENT `osae`.`osae_ev_off_timer`;

DELIMITER |
CREATE EVENT `osae_ev_off_timer` ON SCHEDULE EVERY 1 SECOND STARTS '2010-05-23 10:09:24' ON COMPLETION NOT PRESERVE ENABLE DO BEGIN
DECLARE vObjectName VARCHAR(200);
DECLARE iLoopCount INT DEFAULT 0;
DECLARE iMethodCount INT DEFAULT 0;
DECLARE iStateCount INT DEFAULT 0;  
DECLARE done INT DEFAULT 0;  
DECLARE cur1 CURSOR FOR SELECT object_name FROM osae_v_object_property WHERE state_name<>'OFF' AND property_name='OFF TIMER' AND property_value IS NOT NULL AND property_value<>'' AND SUBTIME(NOW(),SEC_TO_TIME(property_value)) > object_last_updated;
DECLARE CONTINUE HANDLER FOR SQLSTATE '02000' SET done = 1;
    CALL osae_sp_object_property_set('SYSTEM','Time',CURTIME(),'SYSTEM','osae_ev_off_timer');
    CALL osae_sp_object_property_set('SYSTEM','Time AMPM',DATE_FORMAT(NOW(),'%h:%i %p'),'SYSTEM','osae_ev_off_timer');    
    CALL osae_sp_system_count_occupants();
    SELECT COUNT(object_name) INTO iLoopCount FROM osae_v_object_property WHERE state_name<>'OFF' AND property_name='OFF TIMER' AND property_value IS NOT NULL AND property_value<>'' AND SUBTIME(NOW(),SEC_TO_TIME(property_value)) > object_last_updated;
    OPEN cur1; 
    Loop_Tag: LOOP
        FETCH cur1 INTO vObjectName;
        IF done THEN
         Leave  Loop_Tag;
        END IF;
            SELECT COUNT(method_id) INTO iMethodCount FROM osae_v_object_method WHERE UPPER(object_name)=UPPER(vObjectName) AND UPPER(method_name)='OFF';
            IF iMethodCount > 0 THEN
                CALL osae_sp_debug_log_add(CONCAT('Turning ',vObjectName,' Off'),'osae_ev_off_timer');
                CALL osae_sp_method_queue_add (vObjectName,'OFF','','','SYSTEM','osae_ev_off_timer');
            ELSE
                SELECT COUNT(state_id) INTO iStateCount FROM osae_v_object_state WHERE UPPER(object_name)=UPPER(vObjectName) AND UPPER(state_name)='OFF';
                IF iStateCount > 0 THEN
                    CALL osae_sp_debug_log_add(CONCAT('Turning ',vObjectName,' Off'),'osae_ev_off_timer');
                    CALL osae_sp_object_state_set (vObjectName,'OFF','SYSTEM','osae_ev_off_timer');
                END IF; 
            END IF;
    END LOOP;
    CLOSE cur1; 
 END|
DELIMITER ;

SET FOREIGN_KEY_CHECKS=@ORIGINAL_FOREIGN_KEY_CHECKS;
SET UNIQUE_CHECKS=@ORIGINAL_UNIQUE_CHECKS;
SET SQL_MODE=@ORIGINAL_SQL_MODE;



SET @ORIGINAL_FOREIGN_KEY_CHECKS=@@FOREIGN_KEY_CHECKS, FOREIGN_KEY_CHECKS=0;
SET @ORIGINAL_UNIQUE_CHECKS=@@UNIQUE_CHECKS, UNIQUE_CHECKS=0;

INSERT INTO `osae_020`.`osae_object_type` VALUES (85, 'WEATHER', 'Weather Data', NULL, 1, 0, 85, 0, 1);
INSERT INTO `osae_020`.`osae_object_type` VALUES (86, 'SERVICE', 'OSA Service', NULL, 1, 0, 86, 0, 1);
INSERT INTO `osae_020`.`osae_object` VALUES (1092, 'Email', 'Email', NULL, 49, NULL, '', NULL, 0, NULL, NULL);
INSERT INTO `osae_020`.`osae_object` VALUES (1099, 'Web Server', 'Web Server', NULL, 83, NULL, '', NULL, 0, NULL, NULL);
INSERT INTO `osae_020`.`osae_object_type_event` VALUES (113, 'ON', 'Updated', 85);
INSERT INTO `osae_020`.`osae_object_type_event` VALUES (114, 'OFF', 'Hung', 85);
INSERT INTO `osae_020`.`osae_object_type_event` VALUES (115, 'ON', 'Started', 86);
INSERT INTO `osae_020`.`osae_object_type_event` VALUES (116, 'OFF', 'Stopped', 86);
INSERT INTO `osae_020`.`osae_object_type_method` VALUES (138, 'ON', 'Updated', 85, '', '', '', '');
INSERT INTO `osae_020`.`osae_object_type_method` VALUES (139, 'OFF', 'Hung', 85, '', '', '', '');
INSERT INTO `osae_020`.`osae_object_type_method` VALUES (140, 'EXECUTE', 'Execute Command', 86, 'Program', 'Arguments', '', '');
INSERT INTO `osae_020`.`osae_object_type_property` VALUES (467, 'Night1 Low', 'String', '', 85, 0);
INSERT INTO `osae_020`.`osae_object_type_property` VALUES (468, 'Night2 Low', 'String', '', 85, 0);
INSERT INTO `osae_020`.`osae_object_type_property` VALUES (469, 'Night3 Low', 'String', '', 85, 0);
INSERT INTO `osae_020`.`osae_object_type_property` VALUES (470, 'Night4 Low', 'String', '', 85, 0);
INSERT INTO `osae_020`.`osae_object_type_property` VALUES (471, 'Day1 High', 'String', '', 85, 0);
INSERT INTO `osae_020`.`osae_object_type_property` VALUES (472, 'Day2 High', 'String', '', 85, 0);
INSERT INTO `osae_020`.`osae_object_type_property` VALUES (473, 'Day3 High', 'String', '', 85, 0);
INSERT INTO `osae_020`.`osae_object_type_property` VALUES (474, 'Day4 High', 'String', '', 85, 0);
INSERT INTO `osae_020`.`osae_object_type_property` VALUES (475, 'Day1 Precip', 'String', '', 85, 0);
INSERT INTO `osae_020`.`osae_object_type_property` VALUES (476, 'Day2 Precip', 'String', '', 85, 0);
INSERT INTO `osae_020`.`osae_object_type_property` VALUES (477, 'Day3 Precip', 'String', '', 85, 0);
INSERT INTO `osae_020`.`osae_object_type_property` VALUES (478, 'Day4 Precip', 'String', '', 85, 0);
INSERT INTO `osae_020`.`osae_object_type_property` VALUES (479, 'Conditions', 'String', '', 85, 0);
INSERT INTO `osae_020`.`osae_object_type_property` VALUES (480, 'Wind Speed', 'String', '', 85, 0);
INSERT INTO `osae_020`.`osae_object_type_property` VALUES (481, 'Wind Directions', 'String', '', 85, 0);
INSERT INTO `osae_020`.`osae_object_type_property` VALUES (482, 'Humidity', 'String', '', 85, 1);
INSERT INTO `osae_020`.`osae_object_type_property` VALUES (483, 'Pressure', 'String', '', 85, 1);
INSERT INTO `osae_020`.`osae_object_type_property` VALUES (484, 'Dewpoint', 'String', '', 85, 0);
INSERT INTO `osae_020`.`osae_object_type_property` VALUES (485, 'Image', 'String', '', 85, 0);
INSERT INTO `osae_020`.`osae_object_type_property` VALUES (486, 'Visibility', 'String', '', 85, 0);
INSERT INTO `osae_020`.`osae_object_type_property` VALUES (487, 'Windchill', 'String', '', 85, 1);
INSERT INTO `osae_020`.`osae_object_type_property` VALUES (488, 'Temp', 'Integer', '', 85, 1);
INSERT INTO `osae_020`.`osae_object_type_property` VALUES (489, 'Last Updated', 'DateTime', '', 85, 0);
INSERT INTO `osae_020`.`osae_object_type_property` VALUES (490, 'Day5 High', 'String', '', 85, 0);
INSERT INTO `osae_020`.`osae_object_type_property` VALUES (491, 'Day6 High', 'String', '', 85, 0);
INSERT INTO `osae_020`.`osae_object_type_property` VALUES (492, 'Night5 Low', 'String', '', 85, 0);
INSERT INTO `osae_020`.`osae_object_type_property` VALUES (493, 'Night6 Low', 'String', '', 85, 0);
INSERT INTO `osae_020`.`osae_object_type_property` VALUES (494, 'Day7 High', 'String', '', 85, 0);
INSERT INTO `osae_020`.`osae_object_type_property` VALUES (495, 'Day5 Precip', 'String', '', 85, 0);
INSERT INTO `osae_020`.`osae_object_type_property` VALUES (496, 'Day6 Precip', 'String', '', 85, 0);
INSERT INTO `osae_020`.`osae_object_type_property` VALUES (497, 'Day7 Precip', 'String', '', 85, 0);
INSERT INTO `osae_020`.`osae_object_type_property` VALUES (498, 'Night7 Low', 'String', '', 85, 0);
INSERT INTO `osae_020`.`osae_object_type_property` VALUES (499, 'Night1 Precip', 'String', '', 85, 0);
INSERT INTO `osae_020`.`osae_object_type_property` VALUES (500, 'Night2 Precip', 'String', '', 85, 0);
INSERT INTO `osae_020`.`osae_object_type_property` VALUES (501, 'Night3 Precip', 'String', '', 85, 0);
INSERT INTO `osae_020`.`osae_object_type_property` VALUES (502, 'Night4 Precip', 'String', '', 85, 0);
INSERT INTO `osae_020`.`osae_object_type_property` VALUES (503, 'Night5 Precip', 'String', '', 85, 0);
INSERT INTO `osae_020`.`osae_object_type_property` VALUES (504, 'Night6 Precip', 'String', '', 85, 0);
INSERT INTO `osae_020`.`osae_object_type_property` VALUES (505, 'Night7 Precip', 'String', '', 85, 0);
INSERT INTO `osae_020`.`osae_object_type_property` VALUES (506, 'Tonight Precip', 'String', '', 85, 0);
INSERT INTO `osae_020`.`osae_object_type_property` VALUES (507, 'Today Precip', 'String', '', 85, 0);
INSERT INTO `osae_020`.`osae_object_type_property` VALUES (508, 'Night1 Forecast', 'String', '', 85, 0);
INSERT INTO `osae_020`.`osae_object_type_property` VALUES (509, 'Night2 Forecast', 'String', '', 85, 0);
INSERT INTO `osae_020`.`osae_object_type_property` VALUES (510, 'Night3 Forecast', 'String', '', 85, 0);
INSERT INTO `osae_020`.`osae_object_type_property` VALUES (511, 'Night4 Forecast', 'String', '', 85, 0);
INSERT INTO `osae_020`.`osae_object_type_property` VALUES (512, 'Night5 Forecast', 'String', '', 85, 0);
INSERT INTO `osae_020`.`osae_object_type_property` VALUES (513, 'Night6 Forecast', 'String', '', 85, 0);
INSERT INTO `osae_020`.`osae_object_type_property` VALUES (514, 'Night7 Forecast', 'String', '', 85, 0);
INSERT INTO `osae_020`.`osae_object_type_property` VALUES (515, 'Tonight Forecast', 'String', '', 85, 0);
INSERT INTO `osae_020`.`osae_object_type_property` VALUES (516, 'Today Forecast', 'String', '', 85, 0);
INSERT INTO `osae_020`.`osae_object_type_property` VALUES (517, 'Day1 Forecast', 'String', '', 85, 0);
INSERT INTO `osae_020`.`osae_object_type_property` VALUES (518, 'Day2 Forecast', 'String', '', 85, 0);
INSERT INTO `osae_020`.`osae_object_type_property` VALUES (519, 'Day3 Forecast', 'String', '', 85, 0);
INSERT INTO `osae_020`.`osae_object_type_property` VALUES (520, 'Day4 Forecast', 'String', '', 85, 0);
INSERT INTO `osae_020`.`osae_object_type_property` VALUES (521, 'Day5 Forecast', 'String', '', 85, 0);
INSERT INTO `osae_020`.`osae_object_type_property` VALUES (522, 'Day6 Forecast', 'String', '', 85, 0);
INSERT INTO `osae_020`.`osae_object_type_property` VALUES (523, 'Day7 Forecast', 'String', '', 85, 0);
INSERT INTO `osae_020`.`osae_object_type_property` VALUES (524, 'Night1 Image', 'String', '', 85, 0);
INSERT INTO `osae_020`.`osae_object_type_property` VALUES (525, 'Night2 Image', 'String', '', 85, 0);
INSERT INTO `osae_020`.`osae_object_type_property` VALUES (526, 'Night3 Image', 'String', '', 85, 0);
INSERT INTO `osae_020`.`osae_object_type_property` VALUES (527, 'Night4 Image', 'String', '', 85, 0);
INSERT INTO `osae_020`.`osae_object_type_property` VALUES (528, 'Night5 Image', 'String', '', 85, 0);
INSERT INTO `osae_020`.`osae_object_type_property` VALUES (529, 'Night6 Image', 'String', '', 85, 0);
INSERT INTO `osae_020`.`osae_object_type_property` VALUES (530, 'Night7 Image', 'String', '', 85, 0);
INSERT INTO `osae_020`.`osae_object_type_property` VALUES (531, 'Tonight Image', 'String', '', 85, 0);
INSERT INTO `osae_020`.`osae_object_type_property` VALUES (532, 'Today Image', 'String', '', 85, 0);
INSERT INTO `osae_020`.`osae_object_type_property` VALUES (533, 'Day1 Image', 'String', '', 85, 0);
INSERT INTO `osae_020`.`osae_object_type_property` VALUES (534, 'Day2 Image', 'String', '', 85, 0);
INSERT INTO `osae_020`.`osae_object_type_property` VALUES (535, 'Day3 Image', 'String', '', 85, 0);
INSERT INTO `osae_020`.`osae_object_type_property` VALUES (536, 'Day4 Image', 'String', '', 85, 0);
INSERT INTO `osae_020`.`osae_object_type_property` VALUES (537, 'Day5 Image', 'String', '', 85, 0);
INSERT INTO `osae_020`.`osae_object_type_property` VALUES (538, 'Day6 Image', 'String', '', 85, 0);
INSERT INTO `osae_020`.`osae_object_type_property` VALUES (539, 'Day7 Image', 'String', '', 85, 0);
INSERT INTO `osae_020`.`osae_object_type_property` VALUES (540, 'Night1 Summary', 'String', '', 85, 0);
INSERT INTO `osae_020`.`osae_object_type_property` VALUES (541, 'Night2 Summary', 'String', '', 85, 0);
INSERT INTO `osae_020`.`osae_object_type_property` VALUES (542, 'Night3 Summary', 'String', '', 85, 0);
INSERT INTO `osae_020`.`osae_object_type_property` VALUES (543, 'Night4 Summary', 'String', '', 85, 0);
INSERT INTO `osae_020`.`osae_object_type_property` VALUES (544, 'Night5 Summary', 'String', '', 85, 0);
INSERT INTO `osae_020`.`osae_object_type_property` VALUES (545, 'Night6 Summary', 'String', '', 85, 0);
INSERT INTO `osae_020`.`osae_object_type_property` VALUES (546, 'Night7 Summary', 'String', '', 85, 0);
INSERT INTO `osae_020`.`osae_object_type_property` VALUES (547, 'Tonight Summary', 'String', '', 85, 0);
INSERT INTO `osae_020`.`osae_object_type_property` VALUES (548, 'Today Summary', 'String', '', 85, 0);
INSERT INTO `osae_020`.`osae_object_type_property` VALUES (549, 'Day1 Summary', 'String', '', 85, 0);
INSERT INTO `osae_020`.`osae_object_type_property` VALUES (550, 'Day2 Summary', 'String', '', 85, 0);
INSERT INTO `osae_020`.`osae_object_type_property` VALUES (551, 'Day3 Summary', 'String', '', 85, 0);
INSERT INTO `osae_020`.`osae_object_type_property` VALUES (552, 'Day4 Summary', 'String', '', 85, 0);
INSERT INTO `osae_020`.`osae_object_type_property` VALUES (553, 'Day5 Summary', 'String', '', 85, 0);
INSERT INTO `osae_020`.`osae_object_type_property` VALUES (554, 'Day6 Summary', 'String', '', 85, 0);
INSERT INTO `osae_020`.`osae_object_type_property` VALUES (555, 'Day7 Summary', 'String', '', 85, 0);
INSERT INTO `osae_020`.`osae_object_type_property` VALUES (556, 'Night1 Label', 'String', '', 85, 0);
INSERT INTO `osae_020`.`osae_object_type_property` VALUES (557, 'Night2 Label', 'String', '', 85, 0);
INSERT INTO `osae_020`.`osae_object_type_property` VALUES (558, 'Night3 Label', 'String', '', 85, 0);
INSERT INTO `osae_020`.`osae_object_type_property` VALUES (559, 'Night4 Label', 'String', '', 85, 0);
INSERT INTO `osae_020`.`osae_object_type_property` VALUES (560, 'Night5 Label', 'String', '', 85, 0);
INSERT INTO `osae_020`.`osae_object_type_property` VALUES (561, 'Night6 Label', 'String', '', 85, 0);
INSERT INTO `osae_020`.`osae_object_type_property` VALUES (562, 'Night7 Label', 'String', '', 85, 0);
INSERT INTO `osae_020`.`osae_object_type_property` VALUES (563, 'Day1 Label', 'String', '', 85, 0);
INSERT INTO `osae_020`.`osae_object_type_property` VALUES (564, 'Day2 Label', 'String', '', 85, 0);
INSERT INTO `osae_020`.`osae_object_type_property` VALUES (565, 'Day3 Label', 'String', '', 85, 0);
INSERT INTO `osae_020`.`osae_object_type_property` VALUES (566, 'Day4 Label', 'String', '', 85, 0);
INSERT INTO `osae_020`.`osae_object_type_property` VALUES (567, 'Day5 Label', 'String', '', 85, 0);
INSERT INTO `osae_020`.`osae_object_type_property` VALUES (568, 'Day6 Label', 'String', '', 85, 0);
INSERT INTO `osae_020`.`osae_object_type_property` VALUES (569, 'Day7 Label', 'String', '', 85, 0);
INSERT INTO `osae_020`.`osae_object_type_property` VALUES (570, 'Sunrise', 'String', '', 85, 0);
INSERT INTO `osae_020`.`osae_object_type_property` VALUES (571, 'Sunset', 'String', '', 85, 0);
INSERT INTO `osae_020`.`osae_object_type_property` VALUES (572, 'Tonight Low', 'String', '', 85, 0);
INSERT INTO `osae_020`.`osae_object_type_property` VALUES (573, 'Today High', 'String', '', 85, 0);
INSERT INTO `osae_020`.`osae_object_type_state` VALUES (109, 'ON', 'Current', 85);
INSERT INTO `osae_020`.`osae_object_type_state` VALUES (110, 'OFF', 'Obsolete', 85);
INSERT INTO `osae_020`.`osae_object_type_state` VALUES (111, 'ON', 'Running', 86);
INSERT INTO `osae_020`.`osae_object_type_state` VALUES (112, 'OFF', 'Stopped', 86);
INSERT INTO `osae_020`.`osae_object_property` VALUES (2529, 1092, 104, '', NULL);
INSERT INTO `osae_020`.`osae_object_property` VALUES (2530, 1092, 105, '', NULL);
INSERT INTO `osae_020`.`osae_object_property` VALUES (2531, 1092, 106, '', NULL);
INSERT INTO `osae`.`osae_object_property` VALUES (2532, 1092, 107, '', NULL);
INSERT INTO `osae`.`osae_object_property` VALUES (2533, 1092, 108, '', NULL);
INSERT INTO `osae`.`osae_object_property` VALUES (2534, 1092, 109, '', NULL);
INSERT INTO `osae`.`osae_object_property` VALUES (2557, 1099, 299, '8081', NULL);
INSERT INTO `osae`.`osae_object_property` VALUES (2558, 1099, 300, '', NULL);
INSERT INTO `osae`.`osae_object_property` VALUES (2559, 1099, 301, '', NULL);
UPDATE `osae`.`osae_object` SET `state_id`=48, `container_id`=43 WHERE `object_id`=1092;
UPDATE `osae`.`osae_object` SET `state_id`=106, `container_id`=43 WHERE `object_id`=1099;
UPDATE `osae`.`osae_object_property` SET `property_value`='0.3.0' WHERE `object_property_id`=582
DELETE FROM `osae`.`osae_object_type_state` WHERE `state_id`=35;
DELETE FROM `osae`.`osae_object_type_state` WHERE `state_id`=36;
DELETE FROM `osae`.`osae_object_type_property` WHERE `property_id`=36;
DELETE FROM `osae`.`osae_object_type_property` WHERE `property_id`=37;
DELETE FROM `osae`.`osae_object_type_property` WHERE `property_id`=38;
DELETE FROM `osae`.`osae_object_type_property` WHERE `property_id`=39;
DELETE FROM `osae`.`osae_object_type_property` WHERE `property_id`=40;
DELETE FROM `osae`.`osae_object_type_property` WHERE `property_id`=41;
DELETE FROM `osae`.`osae_object_type_property` WHERE `property_id`=42;
DELETE FROM `osae`.`osae_object_type_property` WHERE `property_id`=43;
DELETE FROM `osae`.`osae_object_type_property` WHERE `property_id`=44;
DELETE FROM `osae`.`osae_object_type_property` WHERE `property_id`=45;
DELETE FROM `osae`.`osae_object_type_property` WHERE `property_id`=46;
DELETE FROM `osae`.`osae_object_type_property` WHERE `property_id`=47;
DELETE FROM `osae`.`osae_object_type_property` WHERE `property_id`=48;
DELETE FROM `osae`.`osae_object_type_property` WHERE `property_id`=49;
DELETE FROM `osae`.`osae_object_type_property` WHERE `property_id`=50;
DELETE FROM `osae`.`osae_object_type_property` WHERE `property_id`=51;
DELETE FROM `osae`.`osae_object_type_property` WHERE `property_id`=52;
DELETE FROM `osae`.`osae_object_type_property` WHERE `property_id`=53;
DELETE FROM `osae`.`osae_object_type_property` WHERE `property_id`=54;
DELETE FROM `osae`.`osae_object_type_property` WHERE `property_id`=55;
DELETE FROM `osae`.`osae_object_type_property` WHERE `property_id`=56;
DELETE FROM `osae`.`osae_object_type_property` WHERE `property_id`=125;
DELETE FROM `osae`.`osae_object_type_property` WHERE `property_id`=233;
DELETE FROM `osae`.`osae_object_type_method` WHERE `method_id`=30;
DELETE FROM `osae`.`osae_object_type_method` WHERE `method_id`=31;
DELETE FROM `osae`.`osae_object_type_event` WHERE `event_id`=32;
DELETE FROM `osae`.`osae_object_type_event` WHERE `event_id`=33;
DELETE FROM `osae`.`osae_object_type` WHERE `object_type_id`=33;
UPDATE `osae`.`osae_object_type` SET `object_type`='WEATHER' WHERE `object_type_id`=85;

SET FOREIGN_KEY_CHECKS=@ORIGINAL_FOREIGN_KEY_CHECKS;
SET UNIQUE_CHECKS=@ORIGINAL_UNIQUE_CHECKS;
